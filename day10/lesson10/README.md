tRPC Context - Краткое руководство
Обзор урока
Урок посвящен работе с контекстом в tRPC - механизму, который позволяет передавать данные во все процедуры tRPC. Контекст идеально подходит для хранения подключений к базе данных, информации об аутентификации и других общих ресурсов.
Ключевые концепции
1. Определение типа контекста
Контекст определяется при инициализации tRPC с помощью .context<TContext>()
Тип может быть выведен из функции или задан явно
Обеспечивает типизацию контекста в процедурах и middleware
2. Создание контекста
Функция createContext() вызывается для каждого запроса tRPC
Батчевые запросы используют общий контекст
Функция передается в обработчик, монтирующий appRouter
3. Inner и Outer контекст
Inner контекст: не зависит от запроса (подключения к БД)
Outer контекст: зависит от запроса (сессия пользователя)
Inner контекст всегда доступен, outer только для HTTP-процедур
4. Ограничение размера батча
Контекст можно использовать для проверки количества запросов в батче
Предотвращает перегрузку сервера большими батчами
Источник
Урок основан на официальной документации: tRPC Context Documentation
Тест по теме "tRPC Context"
Вопрос 1
Для чего предназначен контекст в tRPC?
A) Только для хранения данных о пользователе
B) Для хранения данных, доступных всем процедурам tRPC, таких как подключения к БД и информация об аутентификации ПРАВИЛЬНО
C) Исключительно для обработки ошибок
D) Только для валидации входных данных
Вопрос 2
В чем разница между inner и outer контекстом?
A) Inner контекст используется только для тестирования
B) Outer контекст всегда доступен во всех процедурах
C) Inner контекст не зависит от запроса и всегда доступен, outer контекст зависит от запроса и доступен только для HTTP-процедур ПРАВИЛЬНО
D) Разницы нет, это одно и то же
Вопрос 3
Когда вызывается функция createContext()?
A) Только при запуске сервера
B) Для каждого запроса tRPC, батчевые запросы используют общий контекст ПРАВИЛЬНО
C) Только для первого запроса в сессии
D) Только для защищенных процедур
